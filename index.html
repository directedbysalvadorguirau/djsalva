<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DJ SALVA #01</title>

  <style>
    body{
      margin:0; background:#fff; font-family:Arial, Helvetica, sans-serif;
      display:flex; min-height:100vh; align-items:center; justify-content:center;
    }
    .wrap{ width:min(980px, 92vw); text-align:center; }
    h1{
      margin:0 0 18px 0;
      font-size:42px; letter-spacing:4px; font-weight:900;
    }

    .player{
      position:relative;
      width:100%;
      aspect-ratio:16/9;
      border-radius:18px;
      overflow:hidden;
      background:#000;
      box-shadow:0 18px 60px rgba(0,0,0,.10);
    }
    video{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    /* Botón CD */
    .cd-btn{
      position:absolute;
      left:50%; top:50%;
      transform:translate(-50%,-50%);
      width:120px; height:120px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      background: radial-gradient(circle at 30% 30%, #fff 0 12%, #ddd 13% 35%, #f7f7f7 36% 60%, #cfcfcf 61% 100%);
      box-shadow:0 14px 35px rgba(0,0,0,.25);
      display:grid;
      place-items:center;
      transition:transform .12s ease, opacity .2s ease;
    }
    .cd-btn:active{ transform:translate(-50%,-50%) scale(.98); }
    .cd-btn::before{
      content:"";
      width:18px; height:18px;
      border-radius:999px;
      background:#111;
      box-shadow: inset 0 0 0 4px #eee;
      display:block;
    }

    /* Rotación del CD cuando suena */
    .spinning{
      animation:spin 1.2s linear infinite;
    }
    @keyframes spin{
      to{ transform:translate(-50%,-50%) rotate(360deg); }
    }

    /* Icono play/pausa (se coloca encima del CD) */
    .icon{
      position:absolute;
      width:44px; height:44px;
      display:grid; place-items:center;
      pointer-events:none;
    }
    .icon svg{ width:44px; height:44px; }

    .hint{
      margin-top:14px;
      font-size:14px;
      color:#444;
      letter-spacing:1px;
    }

    .bar{
      margin:18px auto 0;
      width:100%;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
    }
    .time{
      font-variant-numeric:tabular-nums;
      font-size:13px;
      color:#111;
      min-width:80px;
      text-align:center;
    }
    input[type="range"]{
      width:min(680px, 80vw);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>DJ SALVA #01</h1>

    <div class="player">
      <!-- Vídeo mudo -->
      <video id="vid" src="video.mp4" preload="metadata" playsinline></video>

      <!-- Botón CD -->
      <button id="cdBtn" class="cd-btn" aria-label="Reproducir/Pausar">
        <span class="icon">
          <!-- PLAY -->
          <svg id="playIcon" viewBox="0 0 64 64" fill="none" style="display:block;">
            <path d="M26 20 L48 32 L26 44 Z" fill="#111"/>
          </svg>
          <!-- PAUSE -->
          <svg id="pauseIcon" viewBox="0 0 64 64" fill="none" style="display:none;">
            <rect x="22" y="18" width="6" height="28" fill="#111"/>
            <rect x="36" y="18" width="6" height="28" fill="#111"/>
          </svg>
        </span>
      </button>
    </div>

    <!-- Audio (master) -->
    <audio id="aud" src="audio.mp3" preload="metadata"></audio>

    <!-- Barra simple -->
    <div class="bar">
      <span class="time" id="tCur">0:00</span>
      <input id="seek" type="range" min="0" max="1000" value="0" />
      <span class="time" id="tDur">0:00</span>
    </div>

    <div class="hint">Pulsa el CD para reproducir</div>
  </div>

  <script>
    const vid = document.getElementById('vid');
    const aud = document.getElementById('aud');
    const cdBtn = document.getElementById('cdBtn');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    const seek = document.getElementById('seek');
    const tCur = document.getElementById('tCur');
    const tDur = document.getElementById('tDur');

    let isPlaying = false;
    let userSeeking = false;

    const fmt = (s) => {
      if (!isFinite(s)) return "0:00";
      s = Math.max(0, Math.floor(s));
      const m = Math.floor(s / 60);
      const r = s % 60;
      return `${m}:${String(r).padStart(2,'0')}`;
    };

    function setUI(playing){
      isPlaying = playing;
      playIcon.style.display = playing ? "none" : "block";
      pauseIcon.style.display = playing ? "block" : "none";
      cdBtn.classList.toggle('spinning', playing);
    }

    // Mantén el vídeo sincronizado con el audio
    function syncVideoToAudio(force=false){
      if (!isFinite(aud.currentTime) || !isFinite(vid.duration)) return;
      const diff = (vid.currentTime || 0) - aud.currentTime;

      // Si hay deriva notable, corrige (buffering, saltos, etc.)
      if (force || Math.abs(diff) > 0.18) {
        try { vid.currentTime = aud.currentTime; } catch(e){}
      }
    }

    async function playBoth(){
      // Asegura que el vídeo esté listo para reproducir
      syncVideoToAudio(true);

      // Reproduce audio y vídeo
      try {
        await aud.play();
      } catch(e){
        // Si el navegador bloquea autoplay, aquí no debería pasar porque es por click
        console.warn(e);
      }

      try {
        await vid.play();
      } catch(e){
        console.warn(e);
      }

      setUI(true);
    }

    function pauseBoth(){
      aud.pause();
      vid.pause();
      setUI(false);
    }

    cdBtn.addEventListener('click', async () => {
      if (!isPlaying) await playBoth();
      else pauseBoth();
    });

    // Cuando carga metadata, setea duración
    aud.addEventListener('loadedmetadata', () => {
      tDur.textContent = fmt(aud.duration);
    });

    // Actualiza barra y sincroniza
    aud.addEventListener('timeupdate', () => {
      if (!userSeeking && isFinite(aud.duration)) {
        seek.value = Math.floor((aud.currentTime / aud.duration) * 1000);
      }
      tCur.textContent = fmt(aud.currentTime);
      syncVideoToAudio(false);
    });

    // Si el vídeo se queda atrás por buffering, el audio manda
    vid.addEventListener('waiting', () => {
      // el vídeo está bufferizando; al reanudar, lo re-sincronizamos
    });
    vid.addEventListener('playing', () => syncVideoToAudio(true));
    vid.addEventListener('seeked', () => syncVideoToAudio(true));

    // Seek manual
    seek.addEventListener('input', () => { userSeeking = true; });
    seek.addEventListener('change', () => {
      if (!isFinite(aud.duration)) return;
      const target = (seek.value / 1000) * aud.duration;
      aud.currentTime = target;
      syncVideoToAudio(true);
      userSeeking = false;
    });

    // Si el audio acaba, para todo
    aud.addEventListener('ended', pauseBoth);

    // Si el usuario pausa con controles del sistema (auriculares)
    aud.addEventListener('pause', () => {
      if (isPlaying) pauseBoth();
    });
    aud.addEventListener('play', () => {
      if (!isPlaying) playBoth();
    });

    // IMPORTANTE: el vídeo NO debe mostrar controles
    vid.controls = false;
  </script>
</body>
</html>
